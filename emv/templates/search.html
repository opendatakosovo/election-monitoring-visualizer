{% extends "layout.html" %}
{% block body %}

<script>
	var pollingStationGroupedByCommuneJson = {{ polling_station_grouped_by_commune_dict|tojson}};

	function initPollingStationDropdown(communeSlug){

		// First clear the polling station drowpown list
		$('#polling_station_select option').remove();

		$('#polling_station_select')
				.append($("<option></option>")
				.attr("value", "")
				.text("")); 

		var pollingStations = pollingStationGroupedByCommuneJson[communeSlug].pollingStations;

		$.each(pollingStations, function(index, obj) {
			$('#polling_station_select')
				.append($("<option></option>")
				.attr("value", obj.slug)
				.text(obj.name)); 
		});

	}

	$(document).ready(function(){

		// Option to search in all communes
		$('#commune_select')
			.append($("<option></option>")
			.attr("value", "")
			.text("")); 

		// Initialize commune name dropdown list.
		// index is the name of the commune.
		// value is the name of the polling stations.
		$.each(pollingStationGroupedByCommuneJson, function(idx, value) {
			$('#commune_select')
				.append($("<option></option>")
				.attr("value", idx)
				.text(value.name)); 

			pollingStationDataRetrieved = true;
		});

		// Initialize polling station name dropdown listin relation to default commune name.
		//initPollingStationDropdown($('#commune_select').find(":selected").val());

		// When new communue is selected, re-initialize the polling station name dropdown list.
		$('#commune_select').change(function(){
			if($('#commune_select').find(":selected").val() == ""){

				$('#polling_station_select option').remove();

				// Option to search in all polling stations.
				$('#polling_station_select')
						.append($("<option></option>")
						.attr("value", "")
						.text("")); 

				$('#polling_station_select').attr('disabled', 'disabled');
			}else{
				$('#polling_station_select').removeAttr('disabled');
				initPollingStationDropdown($(this).val())
			}

			// Still want to submit even if disabled
			$('#polling_station_hidden').val($('#polling_station_select').find(":selected").val())
		});	

	});
</script>

<form class="form-horizontal">

	<div class="form-group">
		<label for="commune_select" class="control-label col-xs-2">Commune</label>
		<div class="col-xs-3">
			<select class="form-control" id="commune_select" name="commune_select">
			</select>
		</div>
	</div>

	<div class="form-group">
		<label for="polling_station_select" class="control-label col-xs-2">Polling Station</label>
		<div class="col-xs-3">
			<select class="form-control" id="polling_station_select" name="polling_station_select" disabled="disabled">
				<option value=""></option>
			</select>
			<!-- Still want to submit even if disabled -->
			<input type="hidden" id="polling_station_hidden" name="polling_station_select" value="" />
		</div>
	</div>

	<div class="form-group">
		<label for="ultra_violet_select" class="control-label col-xs-2">Ultra Violet</label>
		<div class="col-xs-3">
			<select class="form-control" id="ultra_violet_control_select" name="ultra_violet_control_select">
				<option value=""></option>
				<option value="always">Always</option>
				<option value="sometimes">Sometimes</option>
				<option value="rarely">Rarely</option>
  				<option value="never">Never</option>
			</select>
		</div>
	</div>

	<div class="form-group">
		<label for="finger_sprayed_select" class="control-label col-xs-2">Finger Sprayed</label>
		<div class="col-xs-3">
			<select class="form-control" id="finger_sprayed_select" name="finger_sprayed_select">
				<option value=""></option>
				<option value="always">Always</option>
				<option value="sometimes">Sometimes</option>
				<option value="rarely">Rarely</option>
  				<option value="never">Never</option>
			</select>
		</div>
	</div>

	<div class="form-group">
		<label class="control-label col-xs-2">
			Missing Materials
		</label>

		<div class="btn-group-vertical col-xs-3" data-toggle="buttons">
			<label class="btn btn-default">
				<input type="checkbox" class="btn btn-default" name="missing_voting_cabin" id="missing_voting_cabin" value="true">Voting Cabin
			</label>
			<label class="btn btn-default">
				<input type="checkbox" class="btn btn-default" name="missing_ballot_box" id="missing_ballot_box" value="true">Ballot Box
			</label>
			<label class="btn btn-default">
				<input type="checkbox" class="btn btn-default" name="missing_ballots" id="missing_ballots" value="true">Ballots
			</label>
			<label class="btn btn-default">
				<input type="checkbox" class="btn btn-default" name="missing_voters_book" id="missing_voters_book" value="true">Voters Book
			</label>
			<label class="btn btn-default">
				<input type="checkbox" class="btn btn-default" name="missing_uv_lamp" id="missing_uv_lamp" value="true">UV Lamp
			</label>
		</div>
	</div>

	<div class="form-group">
        <div class="col-xs-offset-4">
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
    </div>
</form>

<hr>
<table class="table" style="width:800px">  
{% for observation in search_result %}
	{% if loop.index == 1 %}
		<thead>
		<tr>
			<th></th>
			<th>Commune</th>
			<th>Polling Station Name</th> 
			<th>Polling Station Number</th>
			<th>Room</th>
		</tr>
		</thead>
		<tbody>
	{% endif %}
		<tr>
			<td>
				{{ loop.index }}
			</td>
			<td>
				<a href="{{ config.BASE_PATH }}/{{ directory_path }}/{{ observation['pollingStation']['communeSlug'] }}" target="_blank">{{ observation['pollingStation']['commune'] }}</a>
			</td>
			<td>
				<a href="{{ config.BASE_PATH }}/{{ directory_path }}/{{ observation['pollingStation']['communeSlug'] }}/{{ observation['pollingStation']['nameSlug'] }}" target="_blank">{{ observation['pollingStation']['name'] }}</a>
			</td>
			<td>
				{{ observation['pollingStation']['number'] }}
			</td>
			<td>
				<a href="{{ config.BASE_PATH }}/{{ directory_path }}/{{ observation['pollingStation']['communeSlug'] }}/{{ observation['pollingStation']['nameSlug'] }}/{{ observation['pollingStation']['roomNumber'] }}" target="_blank">{{ observation['pollingStation']['roomNumber'] }}</a>
			</td>
		</tr>
{% endfor %}
  		</tbody>
</table>
{% endblock %}
